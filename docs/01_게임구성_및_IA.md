# Cute Pomodoro — 게임 구성 및 IA

---

## 1. 앱 전체 화면 맵 (IA)

```
[앱 진입]
    │
    ├─ [로딩 스피너] ← Supabase 세션 확인 중
    │
    ├─ [인증 게이트] ← 미로그인 & 게스트 미선택 시
    │       ├─ 로그인 / 회원가입 폼
    │       └─ "게스트로 계속하기" → 게임 진입
    │
    ├─ [온보딩: 캐릭터 선택] ← 최초 1회 (캐릭터 미선택 시)
    │       ├─ 고양이 / 여우 선택
    │       └─ 닉네임 입력 → 게임 진입
    │
    └─ [메인 앱]
            ├─ 상단 헤더 (고정)
            │       ├─ 로고 + 닉네임
            │       ├─ 코인 표시 🪙
            │       ├─ 상점 버튼 🛍️ → [상점 바텀시트]
            │       └─ 로그인 / 로그아웃 버튼
            │
            ├─ 좌측 패널 (데스크탑 전용, 고정)
            │       ├─ 캐릭터 뷰 (장착 아이템 반영)
            │       ├─ 미니 타이머 (타이머 동작 중일 때)
            │       └─ 닉네임 뱃지
            │
            ├─ 콘텐츠 영역 (탭 전환)
            │       ├─ [홈 탭] — 타이머
            │       ├─ [친구방 탭] — 멀티플레이 방
            │       ├─ [캘린더 탭] — 집중 기록
            │       └─ [인벤토리 탭] — 아이템 / 합성
            │
            └─ 하단 네비게이션 바 (고정)
                    홈 | 친구방 | 캘린더 | 인벤토리
```

---

## 2. 유저 플로우

### 2-1. 최초 진입 플로우

```
앱 접속
  → Supabase 세션 확인 (로딩 스피너)
  → 미로그인: 인증 페이지 표시
      ├─ [로그인] → 기존 계정으로 진입 → 클라우드 데이터 로드
      ├─ [회원가입] → 신규 계정 생성 → 캐릭터 선택
      └─ [게스트로 계속하기] → 로컬 저장만 사용
  → 캐릭터 미선택: 캐릭터 선택 화면
      → 고양이 / 여우 선택 + 닉네임 입력
  → 메인 앱 진입
```

### 2-2. 핵심 게임 루프 (집중 → 보상)

```
[홈 탭] 타이머 화면
  → ▶ 시작 버튼 클릭
  → 집중 타이머 카운트다운 (기본 25분)
  → 타이머 완료
      ├─ 코인 +50 지급
      ├─ 집중 세션 기록 저장
      ├─ 업적 달성 체크 (최초 완료, 야간학습자, 새벽학습자)
      ├─ 아이템 박스 자동 추첨 → [아이템 보상 팝업] 표시
      └─ 1.2초 후 → 휴식 타이머로 자동 전환
  → [아이템 보상 팝업] 닫기 → 아이템 인벤토리에 추가
  → 휴식 타이머 완료 → 집중 타이머로 자동 전환
```

### 2-3. 상점 이용 플로우

```
헤더 [🛍️ 상점] 버튼
  → 상점 바텀시트 열림
  → 박스 3종 표시 (일반/프리미엄/전설)
  → [구매] 버튼 (코인 부족 시 비활성)
  → 코인 차감 → 아이템 추첨 (0.7초 애니메이션)
  → 획득 아이템 결과 표시
  → 인벤토리에 자동 추가
```

### 2-4. 인벤토리 / 합성 플로우

```
[인벤토리 탭]
  → 보유 아이템 목록 (배경/악세서리/스킨 필터)
  → 아이템 클릭 → 장착/해제
  → [합성] 버튼 클릭 → 합성 화면
      → 같은 희귀도 아이템 10개 선택
      → [합성하기] → 결과 아이템 획득 (확률적 등급 변환)
      → 업적 '연금술사' 달성 처리
```

### 2-5. 친구방 플로우

```
[친구방 탭]
  ├─ [방 만들기]
  │     → 6자리 방 코드 자동 생성
  │     → 방 코드 공유 → 친구들이 입장
  │     → 업적 '소셜버터플라이' 달성
  │
  └─ [방 참여하기]
        → 6자리 코드 입력
        → 방 입장 (최대 10명)
        → 업적 '소셜버터플라이' 달성

[방 참여 후]
  → 멤버 목록 (캐릭터, 닉네임, 타이머 상태, 오늘 집중 시간)
  → 오늘 집중 시간 기준 실시간 랭킹
  → 타이머 상태 실시간 브로드캐스트
        - 타이머 시작/일시정지/완료 시 방 멤버에게 자동 전달
  → [방 나가기]
```

---

## 3. 화면별 기능 요약

### 3-1. 홈 탭 (타이머)

| 요소 | 설명 |
|------|------|
| 원형 프로그레스 바 | 남은 시간 시각화 (SVG 그라디언트) |
| 시간 표시 | MM:SS 형식 |
| 모드 표시 | 집중 / 짧은 휴식 / 긴 휴식 (색상으로 구분) |
| 사이클 점 | 4개 점 → 4사이클 완료 시 긴 휴식 진입 표시 |
| 총 완료 횟수 | 지금까지 완료한 집중 세션 총 수 |
| ▶/⏸ 버튼 | 시작 / 일시정지 |
| ↺ 버튼 | 타이머 리셋 |
| ⚙ 버튼 | 설정 패널 토글 (집중·휴식 시간 조정) |

**모드 색상 코드**
- 집중: 로즈(#FF6B8A)
- 짧은 휴식: 민트(#7EDBB7)
- 긴 휴식: 스카이(#89C4F4)

### 3-2. 친구방 탭

| 상태 | 표시 내용 |
|------|----------|
| 방 미참여 | 방 만들기 / 방 참여하기 버튼 |
| 방 생성 후 | 6자리 코드 + 복사 버튼, 멤버 목록 |
| 방 참여 후 | 멤버 랭킹 목록 (1위/2위/3위 메달), 방 나가기 버튼 |

**멤버 카드 표시 정보**
- 캐릭터 이미지 + 닉네임
- 타이머 상태 도트 (회색=대기, 빨강=집중중, 노랑=일시정지, 초록=완료)
- 활성 타이머 시 실시간 남은 시간
- 오늘 총 집중 시간 (MM분 SS초)

### 3-3. 캘린더 탭

- 월별 달력 뷰
- 집중 세션이 있는 날짜에 시각적 표시
- 날짜 클릭 시 해당 날의 세션 목록 (시작 시간, 집중 시간)

### 3-4. 인벤토리 탭

- 보유 아이템 목록 (탭: 전체 / 배경 / 악세서리 / 스킨)
- 아이템 카드: 이름, 희귀도 뱃지, 아이콘, 중복 시 수량 표시
- 장착 중인 아이템: 핑크 테두리 + 체크마크
- [합성] 버튼 → 합성 화면 진입

---

## 4. 뽀모도로 게임 루프 상세

### 4-1. 사이클 구조

```
[세트 1개 = 집중 4회 + 짧은 휴식 3회 + 긴 휴식 1회]

집중(25m) → 짧은 휴식(5m)
         → 집중(25m) → 짧은 휴식(5m)
         → 집중(25m) → 짧은 휴식(5m)
         → 집중(25m) → 긴 휴식(15m) ← 세트 완료
         → 다음 세트 시작 (무한 반복)
```

### 4-2. 사이클 변수

| 변수 | 설명 |
|------|------|
| `cycleInSet` | 현재 세트 내 몇 번째 집중인지 (0~3) |
| `cyclesUntilLongBreak` | 긴 휴식까지 필요한 집중 횟수 (기본 4, 설정 가능) |
| `cyclesCompleted` | 지금까지 완료한 총 집중 횟수 |

### 4-3. 집중 완료 시 처리 순서 (App.tsx)

1. 알림음 재생
2. 코인 +50
3. 세션 기록 저장 (`sessionHistory`에 추가)
4. 업적 체크 (최초 완료, 시간대별)
5. 친구방 오늘 집중 시간 브로드캐스트
6. 아이템 무료 추첨 → `pendingReward`에 저장
7. 1.2초 후 다음 휴식 모드로 전환

### 4-4. 기본 타이머 설정값

| 설정 | 기본값 | 단위 |
|------|--------|------|
| 집중 시간 | 25분 (1500초) | 초 |
| 짧은 휴식 | 5분 (300초) | 초 |
| 긴 휴식 | 15분 (900초) | 초 |
| 긴 휴식 주기 | 4사이클마다 | 회 |

---

## 5. 인증 & 데이터 흐름

### 5-1. 인증 상태

| 상태 | 의미 | 데이터 저장 위치 |
|------|------|-----------------|
| `loading` | Supabase 세션 확인 중 | - |
| `authenticated` | 이메일 로그인 완료 | localStorage + Supabase 클라우드 |
| `guest` | 비로그인 (게스트) | localStorage만 |

### 5-2. 게스트 → 로그인 전환

- 게스트로 플레이 중 로그인 시도 시 선택지 제공:
  - **현재 진행 유지**: 로컬 데이터를 클라우드에 업로드
  - **새로 시작**: 로컬 데이터 초기화 후 로그인

---

## 6. UI/UX 원칙

- **귀여움 우선**: 크림색 배경, 로즈/라벤더/민트 컬러 팔레트
- **애니메이션 풍부**: Framer Motion 기반 스프링 애니메이션 전반 사용
- **모바일 우선**: 하단 고정 내비게이션, safe-area 대응
- **즉각 피드백**: 버튼 클릭음, 알림음, 시각적 트랜지션
- **데스크탑 확장**: 좌측 캐릭터 패널 추가 (3컬럼 그리드)
